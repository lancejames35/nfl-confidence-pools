<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item">
                            <a href="/dashboard" class="text-decoration-none">Dashboard</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <%= league.league_name %>
                        </li>
                    </ol>
                </nav>
                <h1 class="display-5 mb-0">
                    <i class="fas fa-users text-primary me-3"></i>
                    <%= league.league_name %>
                </h1>
            </div>
            <div class="btn-group" role="group">
                <% if (isCommissioner) { %>
                    <button type="button" class="btn btn-outline-primary" id="settingsToggleBtn">
                        <i class="fas fa-cog me-2"></i>
                        Settings
                    </button>
                    <button type="button" class="btn btn-outline-info" id="liveScoresToggleBtn">
                        <i class="fas fa-broadcast-tower me-2"></i>
                        Live Scores
                    </button>
                <% } else { %>
                    <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#leaveModal">
                        <i class="fas fa-sign-out-alt me-2"></i>
                        Leave League
                    </button>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- League Settings (Collapsible) -->
<% if (isCommissioner) { %>
<div class="collapse" id="leagueSettings">
    <div class="card border-warning mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">
                <i class="fas fa-cog me-2"></i>
                League Settings
            </h5>
        </div>
        <div class="card-body">
            <div id="leagueSettingsForm">
                <!-- Basic Information -->
                <h6 class="text-muted mb-3"><i class="fas fa-info-circle me-2"></i>Basic Information</h6>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label for="league_name" class="form-label">League Name</label>
                        <input type="text" class="form-control" id="league_name" name="league_name" value="<%= league.league_name %>" required maxlength="50">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="3" maxlength="500" placeholder="Optional league description..."><%= league.description || '' %></textarea>
                </div>
                
                <!-- League Settings -->
                <h6 class="text-muted mb-3 mt-4"><i class="fas fa-cogs me-2"></i>League Settings</h6>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="privacy" class="form-label">Privacy</label>
                        <select class="form-select" id="privacy" name="privacy" required>
                            <option value="private" <%= (league.privacy || 'private') === 'private' ? 'selected' : '' %>>Private (Join code required)</option>
                            <option value="invite_only" <%= league.privacy === 'invite_only' ? 'selected' : '' %>>Invite Only</option>
                            <option value="public" <%= league.privacy === 'public' ? 'selected' : '' %>>Public (Anyone can find)</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="max_participants" class="form-label">Max Participants</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="max_participants" name="max_participants" 
                                   value="<%= (league.max_participants && league.max_participants < 999) ? league.max_participants : 50 %>" 
                                   min="2" max="500" <%= (!league.max_participants || league.max_participants >= 999) ? 'disabled' : '' %>>
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" type="checkbox" id="unlimited_participants" 
                                       <%= (!league.max_participants || league.max_participants >= 999) ? 'checked' : '' %>>
                                <label class="form-check-label ms-1" for="unlimited_participants">Unlimited</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="max_entries" class="form-label">Max Entries per User</label>
                        <select class="form-select" id="max_entries" name="max_entries">
                            <option value="1" <%= league.max_entries == 1 ? 'selected' : '' %>>1 Entry</option>
                            <option value="2" <%= league.max_entries == 2 ? 'selected' : '' %>>2 Entries</option>
                            <option value="3" <%= league.max_entries == 3 ? 'selected' : '' %>>3 Entries</option>
                            <option value="4" <%= league.max_entries == 4 ? 'selected' : '' %>>4 Entries</option>
                            <option value="5" <%= league.max_entries == 5 ? 'selected' : '' %>>5 Entries</option>
                            <option value="999" <%= (!league.max_entries || league.max_entries >= 999) ? 'selected' : '' %>>Unlimited</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3" id="entry-fee-section">
                        <label for="entry_fee" class="form-label">Entry Fee ($)</label>
                        <input type="number" class="form-control" id="entry_fee" name="entry_fee" value="<%= league.entry_fee %>" min="0" max="1000" step="0.01">
                        <div class="form-text">Set to 0 for free leagues</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check mt-4">
                            <input class="form-check-input" type="checkbox" id="enable_multi_tier" name="enable_multi_tier" <%= league.enable_multi_tier ? 'checked' : '' %>>
                            <label class="form-check-label" for="enable_multi_tier">
                                Enable Multiple Entry Levels
                            </label>
                        </div>
                        <div class="form-text">Allow different participation levels with different fees</div>
                    </div>
                </div>
                
                <!-- Multi-Tier Entry Fee Settings -->
                <div id="multi-tier-settings" style="display: none;">
                    <div class="card mt-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0"><i class="fas fa-layer-group me-2"></i>Entry Level Tiers</h6>
                            <button type="button" class="btn btn-sm btn-success" id="addTierBtn">
                                <i class="fas fa-plus me-1"></i>Add Tier
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="tiers-container">
                                <!-- Display existing tiers or default tiers -->
                                <% if (locals.tiers && tiers.length > 0) { %>
                                    <% tiers.forEach((tier, index) => { %>
                                        <div class="tier-row" data-tier="<%= index + 1 %>">
                                            <div class="row mb-3">
                                                <div class="col-md-4">
                                                    <label class="form-label">Tier Name <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="tier_name[]" value="<%= tier.tier_name %>" placeholder="e.g., Standard" required>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Entry Fee ($) <span class="text-danger">*</span></label>
                                                    <input type="number" class="form-control" name="tier_fee[]" value="<%= tier.entry_fee %>" min="0" step="0.01" required>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label">Description <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="tier_description[]" value="<%= tier.tier_description || '' %>" placeholder="Describe what this tier includes" required>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label">&nbsp;</label>
                                                    <button type="button" class="btn btn-sm btn-outline-danger d-block remove-tier-btn" title="Remove tier" <%= index === 0 ? 'disabled' : '' %>>
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    <% }); %>
                                <% } else { %>
                                    <!-- Default tiers when multi-tier is first enabled -->
                                    <div class="tier-row" data-tier="1">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Tier Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" name="tier_name[]" value="" placeholder="e.g., Standard" required>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Entry Fee ($) <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" name="tier_fee[]" value="<%= league.entry_fee || 0 %>" min="0" step="0.01" required>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Description <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" name="tier_description[]" value="" placeholder="Describe what this tier includes" required>
                                            </div>
                                            <div class="col-md-1">
                                                <label class="form-label">&nbsp;</label>
                                                <button type="button" class="btn btn-sm btn-outline-danger d-block remove-tier-btn" title="Remove tier" disabled>
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tier-row" data-tier="2">
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Tier Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" name="tier_name[]" value="" placeholder="e.g., Premium" required>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Entry Fee ($) <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" name="tier_fee[]" value="<%= (league.entry_fee || 0) * 2 %>" min="0" step="0.01" required>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Description <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" name="tier_description[]" value="" placeholder="Describe what this tier includes" required>
                                            </div>
                                            <div class="col-md-1">
                                                <label class="form-label">&nbsp;</label>
                                                <button type="button" class="btn btn-sm btn-outline-danger d-block remove-tier-btn" title="Remove tier">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                            
                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Tip:</strong> Users can choose their participation level when joining. Higher tiers typically include all benefits of lower tiers plus additional prize pools.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Confidence Pool Settings -->
                <div id="confidence-settings" style="display: none;">
                    <h6 class="text-muted mb-3 mt-4"><i class="fas fa-football me-2"></i>Confidence Pool Settings</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="pick_method" class="form-label">Pick Method</label>
                            <select class="form-select" id="pick_method" name="pick_method">
                                <option value="straight_up" <%= (league.pick_method || 'straight_up') === 'straight_up' ? 'selected' : '' %>>Straight Up (Pick winners)</option>
                                <option value="against_spread" <%= league.pick_method === 'against_spread' ? 'selected' : '' %>>Against the Spread</option>
                            </select>
                            <div class="form-text">Straight up picks team to win. Spread picks team to cover the point spread.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="point_system" class="form-label">Point System</label>
                            <select class="form-select" id="point_system" name="point_system">
                                <option value="standard" <%= (league.point_system || 'standard') === 'standard' ? 'selected' : '' %>>Standard (1, 2, 3, 4... points)</option>
                                <option value="multiplier" <%= league.point_system === 'multiplier' ? 'selected' : '' %>>Multiplier (confidence × multiplier)</option>
                            </select>
                            <div class="form-text">Higher confidence picks are worth more points if correct.</div>
                        </div>
                    </div>
                    
                    <!-- Multiplier Setting -->
                    <div class="row" id="multiplier-setting" style="display: none;">
                        <div class="col-md-4 mb-3">
                            <label for="point_multiplier" class="form-label">Point Multiplier</label>
                            <input type="number" class="form-control" id="point_multiplier" name="point_multiplier" value="<%= league.point_multiplier || 2 %>" min="1" max="10" step="0.5">
                            <div class="form-text">×2 = (2, 4, 6...), ×5 = (5, 10, 15...)</div>
                        </div>
                        <div class="col-md-8 mb-3">
                            <label class="form-label text-muted">Point Preview</label>
                            <div class="border rounded p-2 bg-light">
                                <small class="text-muted" id="point-preview">Confidence 1 = 2 pts, Confidence 2 = 4 pts, Confidence 16 = 32 pts</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deadline Settings -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="deadline_type" class="form-label">Pick Deadline</label>
                            <select class="form-select" id="deadline_type" name="deadline_type">
                                <option value="per_game" <%= (league.deadline_type || 'per_game') === 'per_game' ? 'selected' : '' %>>Per Game (locks when each game starts)</option>
                                <option value="league_wide" <%= league.deadline_type === 'league_wide' ? 'selected' : '' %>>League-wide (all picks lock at same time)</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3" id="league_deadline_time" style="display: none;">
                            <label for="weekly_deadline" class="form-label">Weekly Deadline</label>
                            <select class="form-select" id="weekly_deadline" name="weekly_deadline">
                                <option value="first_game" <%= (league.weekly_deadline || 'first_game') === 'first_game' ? 'selected' : '' %>>Before 1st Game Kickoff</option>
                                <option value="thursday_night" <%= league.weekly_deadline === 'thursday_night' ? 'selected' : '' %>>Thursday Night Game</option>
                                <option value="sunday_early" <%= league.weekly_deadline === 'sunday_early' ? 'selected' : '' %>>Sunday Early Games (1:00 PM ET)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Tiebreaker Settings -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="primary_tiebreaker" class="form-label">Primary Tiebreaker</label>
                            <select class="form-select" id="primary_tiebreaker" name="primary_tiebreaker">
                                <option value="head_to_head" <%= (league.settings && league.settings.primary_tiebreaker === 'head_to_head') ? 'selected' : '' %>>Head to Head</option>
                                <option value="mnf_total" <%= (league.settings && league.settings.primary_tiebreaker === 'mnf_total') ? 'selected' : '' %>>Monday Night Football Total Points</option>
                                <option value="highest_confidence_correct" <%= (league.settings && league.settings.primary_tiebreaker === 'highest_confidence_correct') ? 'selected' : '' %>>Highest Confidence Correct</option>
                                <option value="total_games_correct" <%= (league.settings && league.settings.primary_tiebreaker === 'total_games_correct') ? 'selected' : '' %>>Total Games Correct</option>
                            </select>
                            <div class="form-text">Used to resolve ties in weekly and season standings</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="secondary_tiebreaker" class="form-label">Secondary Tiebreaker</label>
                            <select class="form-select" id="secondary_tiebreaker" name="secondary_tiebreaker">
                                <option value="head_to_head" <%= (league.settings && league.settings.secondary_tiebreaker === 'head_to_head') ? 'selected' : '' %>>Head to Head</option>
                                <option value="mnf_total" <%= (league.settings && league.settings.secondary_tiebreaker === 'mnf_total') ? 'selected' : '' %>>Monday Night Football Total Points</option>
                                <option value="highest_confidence_correct" <%= (league.settings && league.settings.secondary_tiebreaker === 'highest_confidence_correct') ? 'selected' : '' %>>Highest Confidence Correct</option>
                                <option value="total_games_correct" <%= (league.settings && league.settings.secondary_tiebreaker === 'total_games_correct') ? 'selected' : '' %>>Total Games Correct</option>
                            </select>
                            <div class="form-text">Applied if primary tiebreaker results in a tie</div>
                        </div>
                    </div>
                </div>
                
                <!-- Payout Settings -->
                <h6 class="text-muted mb-3 mt-4"><i class="fas fa-money-bill-wave me-2"></i>Payout Settings</h6>
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="payout_calculations_enabled" 
                                       name="payout_calculations_enabled">
                                <label class="form-check-label" for="payout_calculations_enabled">
                                    <strong>Enable Automatic Payout Calculations</strong>
                                </label>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="recalculate-purse-btn">
                                <i class="fas fa-sync-alt me-1"></i>Recalculate Purse
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <!-- Purse Information (Always Visible) -->
                        <div class="bg-info-subtle border border-info rounded p-3 mb-3">
                            <div class="row text-center">
                                <div class="col-6 col-md-3">
                                    <div class="h5 mb-1 text-info">$<span id="totalPurse">0.00</span></div>
                                    <small class="text-muted">Total Purse</small>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="h5 mb-1 text-warning">$<span id="expenseAmount">0.00</span></div>
                                    <small class="text-muted">Expenses</small>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="h5 mb-1 text-success">$<span id="netPurse">0.00</span></div>
                                    <small class="text-muted">Net Purse</small>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="h5 mb-1" id="unallocatedContainer">
                                        <span class="text-secondary">$<span id="unallocatedAmount">0.00</span></span>
                                    </div>
                                    <small class="text-muted">Unallocated</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Manual Message Mode -->
                        <div id="manualPayoutMode" style="display: none;">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Manual Payout Mode:</strong> Automatic calculations are disabled. You can enter a custom message for the dashboard.
                            </div>
                            <div class="mb-3">
                                <label for="manual_payout_message" class="form-label">Payout Message for Dashboard</label>
                                <textarea class="form-control" id="manual_payout_message" name="manual_payout_message" rows="3"
                                          placeholder="Enter a message about payouts that will be displayed on the dashboard..."></textarea>
                                <div class="form-text">This message will appear on the dashboard instead of calculated payouts.</div>
                            </div>
                        </div>
                        
                        <!-- Automatic Calculation Mode -->
                        <div id="automaticPayoutMode" style="display: none;">
                            <!-- LEVEL 1: Pool Allocation -->
                            <h6 class="text-primary mb-3 mt-3">
                                <i class="fas fa-layer-group me-2"></i>Level 1: Pool Allocation
                            </h6>
                            
                            <!-- Expenses -->
                            <div class="card mb-3 border-warning">
                                <div class="card-header bg-warning-subtle">
                                    <strong><i class="fas fa-receipt me-2"></i>Expenses</strong>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="expense_amount" class="form-label">Amount ($)</label>
                                            <input type="number" class="form-control" id="expense_amount" name="expense_amount" 
                                                   value="0" min="0" step="0.01">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="expense_description" class="form-label">Description</label>
                                            <input type="text" class="form-control" id="expense_description" name="expense_description" 
                                                   placeholder="Website fees, prizes, etc.">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Weekly Pool -->
                            <div class="card mb-3 border-primary">
                                <div class="card-header bg-primary-subtle">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="weekly_pool_enabled" 
                                               name="weekly_pool_enabled">
                                        <label class="form-check-label" for="weekly_pool_enabled">
                                            <strong><i class="fas fa-calendar-week me-2"></i>Weekly Pool</strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body" id="weeklyPoolSettings">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Pool Allocation</label>
                                            <div class="input-group">
                                                <select class="form-select" id="weekly_pool_type" style="max-width: 140px;">
                                                    <option value="percentage" selected>% of Net</option>
                                                    <option value="fixed">Fixed $</option>
                                                </select>
                                                <input type="number" class="form-control" id="weekly_pool_percentage" 
                                                       value="70" min="0" max="100" step="0.01">
                                                <span class="input-group-text" id="weekly_pool_suffix">%</span>
                                            </div>
                                            <div class="form-text">Total pool: $<span id="weeklyPoolTotal">0.00</span> | Per week: $<span id="weeklyPoolPerWeek">0.00</span></div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Positions to Pay</label>
                                            <div class="input-group">
                                                <button type="button" class="btn btn-outline-secondary" data-action="weekly-decrease">
                                                    <i class="fas fa-minus"></i>
                                                </button>
                                                <input type="number" class="form-control text-center" id="weekly_positions" 
                                                       name="weekly_positions" value="3" min="1" max="10" readonly>
                                                <button type="button" class="btn btn-outline-secondary" data-action="weekly-increase">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                            <div class="form-text">Pay top <span id="weeklyPositionsLabel">3</span> positions each week</div>
                                        </div>
                                    </div>
                                    
                                    <!-- LEVEL 2: Weekly Position Distribution -->
                                    <h6 class="text-secondary mb-2">
                                        <i class="fas fa-trophy me-2"></i>Level 2: Position Distribution
                                    </h6>
                                    <div id="weeklyPositionBreakdown">
                                        <!-- Generated dynamically -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Season Pool -->
                            <div class="card border-success">
                                <div class="card-header bg-success-subtle">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="season_pool_enabled" 
                                               name="season_pool_enabled">
                                        <label class="form-check-label" for="season_pool_enabled">
                                            <strong><i class="fas fa-crown me-2"></i>Season Pool</strong>
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body" id="seasonPoolSettings">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Pool Allocation</label>
                                            <div class="input-group">
                                                <select class="form-select" id="season_pool_type" style="max-width: 140px;">
                                                    <option value="percentage" selected>% of Net</option>
                                                    <option value="fixed">Fixed $</option>
                                                </select>
                                                <input type="number" class="form-control" id="season_pool_percentage" 
                                                       value="30" min="0" max="100" step="0.01">
                                                <span class="input-group-text" id="season_pool_suffix">%</span>
                                            </div>
                                            <div class="form-text">Total pool: $<span id="seasonPoolTotal">0.00</span></div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Positions to Pay</label>
                                            <div class="input-group">
                                                <button type="button" class="btn btn-outline-secondary" data-action="season-decrease">
                                                    <i class="fas fa-minus"></i>
                                                </button>
                                                <input type="number" class="form-control text-center" id="season_positions" 
                                                       name="season_positions" value="3" min="1" max="10" readonly>
                                                <button type="button" class="btn btn-outline-secondary" data-action="season-increase">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                            <div class="form-text">Pay top <span id="seasonPositionsLabel">3</span> positions at season end</div>
                                        </div>
                                    </div>
                                    
                                    <!-- LEVEL 2: Season Position Distribution -->
                                    <h6 class="text-secondary mb-2">
                                        <i class="fas fa-medal me-2"></i>Level 2: Position Distribution
                                    </h6>
                                    <div id="seasonPositionBreakdown">
                                        <!-- Generated dynamically -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between mt-4">
                    <div>
                        <button type="button" class="btn btn-secondary me-2" id="cancelSettingsBtn">Cancel</button>
                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="fas fa-trash me-2"></i>
                            Delete League
                        </button>
                    </div>
                    <button type="button" class="btn btn-warning" id="saveSettingsBtn">
                        <i class="fas fa-save me-2"></i>
                        Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Live Scores Monitoring (Commissioner Only) -->
<div class="collapse" id="liveScoresMonitoring">
    <div class="card border-info mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">
                <i class="fas fa-broadcast-tower me-2"></i>
                Live Scores Monitoring
            </h5>
        </div>
        <div class="card-body">
            <div id="liveScoresStatus">
                <div class="text-center">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">Loading live scores status...</p>
                </div>
            </div>
            
            <div class="mt-3 d-flex gap-2">
                <button type="button" class="btn btn-outline-info btn-sm" id="refreshStatusBtn">
                    <i class="fas fa-sync-alt me-1"></i>
                    Refresh Status
                </button>
            </div>
        </div>
    </div>
</div>
<% } %>

<!-- League Overview Cards -->
<div class="row g-3 mb-4">
    <div class="col-6 col-lg-3">
        <div class="card bg-primary text-white h-100">
            <div class="card-body text-center p-3">
                <i class="fas fa-users fa-lg mb-2"></i>
                <h6 class="card-title mb-1"><%= league.member_count %>/<%= league.max_participants %></h6>
                <p class="card-text mb-0 small">Members</p>
            </div>
        </div>
    </div>
    
    <div class="col-6 col-lg-3">
        <div class="card bg-success text-white h-100">
            <div class="card-body text-center p-3">
                <i class="fas fa-list-ol fa-lg mb-2"></i>
                <h6 class="card-title mb-1"><%= league.entry_count %></h6>
                <p class="card-text mb-0 small">Total Entries</p>
            </div>
        </div>
    </div>
    
    <div class="col-6 col-lg-3">
        <div class="card bg-warning text-dark h-100">
            <div class="card-body text-center p-3">
                <i class="fas fa-football-ball fa-lg mb-2"></i>
                <h6 class="card-title mb-1"><%= league.pool_type.charAt(0).toUpperCase() + league.pool_type.slice(1) %></h6>
                <p class="card-text mb-0 small">Pool Type</p>
            </div>
        </div>
    </div>
    
    <div class="col-6 col-lg-3">
        <div class="card bg-info text-white h-100">
            <div class="card-body text-center p-3">
                <i class="fas fa-<%= league.enable_multi_tier ? 'layer-group' : (league.entry_fee > 0 ? 'dollar-sign' : 'gift') %> fa-lg mb-2"></i>
                <h6 class="card-title mb-1">
                    <% if (league.enable_multi_tier) { %>
                        Multi-Tier
                    <% } else if (league.entry_fee > 0) { %>
                        $<%= parseFloat(league.entry_fee).toFixed(2) %>
                    <% } else { %>
                        Free
                    <% } %>
                </h6>
                <p class="card-text mb-0 small">
                    Entry Fee
                </p>
            </div>
        </div>
    </div>
</div>

<!-- League Information and Commissioner Messages Row -->
<div class="row g-3 mb-4">
    <!-- League Information -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    League Information
                </h5>
            </div>
            <div class="card-body">
                <% if (league.description && league.description.trim()) { %>
                    <div class="row mb-3">
                        <div class="col-12">
                            <strong class="text-muted">Description:</strong>
                            <p class="mb-0 mt-1"><%= league.description %></p>
                        </div>
                    </div>
                <% } %>
                
                <div class="row align-items-center">
                    <div class="col-lg-3 col-md-6 mb-2">
                        <strong class="text-muted">Commissioner:</strong><br>
                        <i class="fas fa-crown text-warning me-1"></i>
                        <%= league.commissioner_name %>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-2">
                        <strong class="text-muted">Season:</strong><br>
                        <i class="fas fa-calendar me-1"></i>
                        <%= league.season_year %>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-2">
                        <strong class="text-muted">Privacy:</strong><br>
                        <i class="fas fa-<%= league.privacy === 'public' ? 'globe' : league.privacy === 'private' ? 'lock' : 'user-shield' %> me-1"></i>
                        <%= league.privacy.charAt(0).toUpperCase() + league.privacy.slice(1).replace('_', ' ') %>
                    </div>
                    <div class="col-lg-2 col-md-6 mb-2">
                        <strong class="text-muted">Status:</strong><br>
                        <span class="badge <%= league.status === 'active' ? 'bg-success' : league.status === 'draft' ? 'bg-warning text-dark' : 'bg-secondary' %>">
                            <%= league.status.charAt(0).toUpperCase() + league.status.slice(1) %>
                        </span>
                    </div>
                    <% if (isCommissioner) { %>
                    <div class="col-lg-3 col-12 mb-2">
                        <strong class="text-muted">Join Code:</strong><br>
                        <div class="d-flex align-items-center">
                            <code class="me-2" id="joinCode"><%= league.join_code %></code>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1" id="copyJoinCodeBtn" title="Copy join code">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-warning" id="regenerateJoinCodeBtn" title="Generate new code">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Commissioner Messages -->
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bullhorn me-2"></i>
                    Commissioner Messages
                </h5>
                <% if (isCommissioner) { %>
                    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#postMessageModal">
                        <i class="fas fa-plus me-1"></i>Post Message
                    </button>
                <% } %>
            </div>
            <div class="card-body p-2" id="commissionerMessages" style="max-height: 300px; overflow-y: auto;">
                <!-- Commissioner messages will be loaded here -->
                <div class="text-muted text-center py-3">
                    <i class="fas fa-message me-2"></i>
                    No messages posted yet
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Members List -->
<div class="row">
    <div class="col-12">
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-users me-2"></i>
                    Members (<%= members.length %>)
                </h5>
                <% if (isCommissioner && members.length < league.max_participants) { %>
                    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#inviteModal">
                        <i class="fas fa-plus me-1"></i>
                        Invite
                    </button>
                <% } %>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Member</th>
                                <th class="d-none d-md-table-cell">Email</th>
                                <th>Tier</th>
                                <th class="text-center">Status</th>
                                <% if (isCommissioner) { %>
                                    <th class="text-center">Actions</th>
                                <% } %>
                            </tr>
                        </thead>
                        <tbody>
                            <% members.forEach(member => { %>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2 flex-shrink-0">
                                                <%= member.username.charAt(0).toUpperCase() %>
                                            </div>
                                            <div class="min-w-0">
                                                <div class="fw-semibold d-flex align-items-center">
                                                    <%= member.username %>
                                                    <% if (member.user_id === league.commissioner_id) { %>
                                                        <i class="fas fa-crown text-warning ms-1" title="Main Commissioner"></i>
                                                    <% } else if (member.role === 'co_commissioner') { %>
                                                        <i class="fas fa-crown text-info ms-1" title="Co-Commissioner"></i>
                                                    <% } %>
                                                </div>
                                                <% if (member.first_name || member.last_name) { %>
                                                    <small class="text-muted">
                                                        <%= (member.first_name || '').trim() %> <%= (member.last_name || '').trim() %>
                                                    </small>
                                                <% } %>
                                                <div class="d-md-none mt-1">
                                                    <small class="text-muted">📧 <%= member.email || 'N/A' %></small>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="d-none d-md-table-cell">
                                        <small class="text-muted">
                                            <%= member.email || 'N/A' %>
                                        </small>
                                    </td>
                                    <td>
                                        <% 
                                        const userTier = member.tier_name || 'Standard';
                                        const tierFee = parseFloat(member.tier_fee || league.entry_fee || 0);
                                        const tierColor = userTier === 'Standard' ? 'secondary' : userTier === 'Premium' ? 'warning' : 'success';
                                        %>
                                        <div>
                                            <span class="badge bg-<%= tierColor %> <%= tierColor === 'warning' ? 'text-dark' : '' %>">
                                                <%= userTier %>
                                            </span>
                                            <div class="small text-muted mt-1">
                                                $<%= tierFee.toFixed(2) %>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <% 
                                        const amountPaid = parseFloat(member.amount_paid) || 0;
                                        // Calculate amount owed based on tier fee or league entry fee
                                        let baseAmount = 0;
                                        if (member.amount_owed && member.amount_owed > 0) {
                                            baseAmount = parseFloat(member.amount_owed);
                                        } else if (member.entry_fee && member.entry_fee > 0) {
                                            baseAmount = parseFloat(member.entry_fee);
                                        } else if (league.entry_fee && league.entry_fee > 0) {
                                            baseAmount = parseFloat(league.entry_fee);
                                        }
                                        const amountOwed = baseAmount * parseInt(member.entry_count || 1);
                                        const tolerance = 0.01; // Small tolerance for floating point comparison
                                        %>
                                        <div class="d-flex flex-column align-items-center">
                                            <% if (amountOwed === 0) { %>
                                                <span class="badge bg-success mb-1">Free</span>
                                            <% } else if (Math.abs(amountPaid - amountOwed) < tolerance) { %>
                                                <span class="badge bg-success mb-1">Paid</span>
                                                <small class="text-muted">$<%= amountPaid.toFixed(2) %></small>
                                            <% } else if (amountPaid > amountOwed + tolerance) { %>
                                                <span class="badge bg-info mb-1">Overpaid</span>
                                                <small class="text-muted">$<%= amountPaid.toFixed(2) %> / $<%= amountOwed.toFixed(2) %></small>
                                            <% } else if (amountPaid > tolerance) { %>
                                                <span class="badge bg-warning mb-1">Partial Payment</span>
                                                <small class="text-muted">$<%= amountPaid.toFixed(2) %> / $<%= amountOwed.toFixed(2) %></small>
                                            <% } else { %>
                                                <span class="badge bg-danger mb-1">Unpaid</span>
                                                <small class="text-muted">$<%= amountOwed.toFixed(2) %></small>
                                            <% } %>
                                            
                                            <% if (member.entry_count > 1) { %>
                                                <small class="text-muted mt-1"><%= member.entry_count %> entries</small>
                                            <% } %>
                                        </div>
                                        
                                        <div class="mt-2">
                                            <small class="text-muted d-block">
                                                Joined <%= new Date(member.joined_at).toLocaleDateString() %>
                                            </small>
                                        </div>
                                    </td>
                                    <% if (isCommissioner) { %>
                                        <td class="text-center">
                                            <button type="button" 
                                                    class="btn btn-sm btn-outline-primary edit-member-btn"
                                                        data-user-id="<%= member.user_id %>"
                                                        data-username="<%= member.username %>"
                                                        data-first-name="<%= member.first_name || '' %>"
                                                        data-last-name="<%= member.last_name || '' %>"
                                                        data-email="<%= member.email %>"
                                                        data-tier="<%= member.tier_name || 'Standard' %>"
                                                        data-tier-id="<%= member.tier_id || '' %>"
                                                        data-payment-status="<%= member.payment_status || 'unpaid' %>"
                                                        data-amount-owed="<%= member.amount_owed || league.entry_fee || 0 %>"
                                                        data-amount-paid="<%= member.amount_paid || 0 %>"
                                                        data-entry-count="<%= member.entry_count || 1 %>"
                                                        data-role="<%= member.role || 'participant' %>"
                                                        title="Edit member">
                                                    <i class="fas fa-edit me-1"></i>Edit
                                                </button>
                                        </td>
                                    <% } %>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Member Modal -->
<% if (isCommissioner) { %>
<div class="modal fade" id="editMemberModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-edit me-2"></i>
                    Edit Member: <span id="editMemberName"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-user me-2"></i>Member Information
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-control" id="editUsername">
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="editFirstName">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="editLastName">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editEmail">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="editPassword" placeholder="Leave blank to keep current password">
                                    <div class="form-text">Enter a new password to change it, or leave blank to keep existing</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Role</label>
                                    <div class="input-group">
                                        <span class="input-group-text" id="editRoleIcon">👤</span>
                                        <input type="text" class="form-control" id="editRoleDisplay" readonly>
                                    </div>
                                    <div class="form-text">
                                        Use the "Make Commissioner" button below to change roles
                                    </div>
                                </div>
                                <% if (league.enable_multi_tier) { %>
                                <div class="mb-3">
                                    <label class="form-label">Tier</label>
                                    <select class="form-select" id="editTier">
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                    <div class="form-text">Select the tier for this member</div>
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-dollar-sign me-2"></i>Payment Information
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Entries</label>
                                    <div class="form-control-plaintext bg-light border rounded px-3 py-2">
                                        <strong id="editEntryCountDisplay">1</strong>
                                    </div>
                                    <div class="form-text">Number of entries for this member (display only)</div>
                                    <input type="hidden" id="editEntryCount" value="1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Amount Owed</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="editAmountOwed" step="0.01" readonly>
                                    </div>
                                    <div class="form-text">Calculated: Entry Fee × Entries × Tier Multiplier</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Amount Paid</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="editAmountPaid" step="0.01">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Payment Status</label>
                                    <div class="input-group">
                                        <span class="input-group-text" id="paymentStatusIcon">📋</span>
                                        <input type="text" class="form-control" id="editPaymentStatus" readonly>
                                    </div>
                                    <div class="form-text">Automatically calculated based on amount paid vs owed</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Payment Method</label>
                                    <select class="form-select" id="editPaymentMethod">
                                        <option value="">Select method...</option>
                                        <option value="cash">Cash</option>
                                        <option value="venmo">Venmo</option>
                                        <option value="paypal">PayPal</option>
                                        <option value="zelle">Zelle</option>
                                        <option value="check">Check</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-cogs me-2"></i>Administrative Actions
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <button type="button" class="btn btn-warning w-100" id="makeCommissionerBtn">
                                            <i class="fas fa-crown me-2"></i>Make Co-Commissioner
                                        </button>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <button type="button" class="btn btn-danger w-100" id="removeMemberBtn">
                                            <i class="fas fa-user-times me-2"></i>Remove Member
                                        </button>
                                    </div>
                                </div>
                                <div class="alert alert-warning mt-3 mb-0">
                                    <small>
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        <strong>Note:</strong> Making someone commissioner will transfer full control of this league to them. This action cannot be undone.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="saveMemberChangesBtn">
                    <i class="fas fa-save me-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>
<% } %>

<!-- Invite Modal -->
<% if (isCommissioner) { %>
<div class="modal fade" id="inviteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus me-2"></i>
                    Invite Members
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Share Join Code</label>
                    <div class="input-group">
                        <input type="text" class="form-control" value="<%= league.join_code %>" readonly id="inviteJoinCode">
                        <button class="btn btn-outline-primary copy-join-code-btn" type="button" data-target="inviteJoinCode">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="form-text">Share this code with friends to join your league</div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Share Join Link</label>
                    <div class="input-group">
                        <input type="text" class="form-control" value="<%= `${baseUrl}/leagues/join?code=${league.join_code}` %>" readonly id="inviteLink">
                        <button class="btn btn-outline-primary copy-join-code-btn" type="button" data-target="inviteLink">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="form-text">Direct link to join your league</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-warning" id="regenerateJoinCodeModalBtn">
                    <i class="fas fa-sync-alt me-2"></i>
                    Generate New Code
                </button>
            </div>
        </div>
    </div>
</div>
<% } %>

<!-- Leave League Modal -->
<% if (!isCommissioner) { %>
<div class="modal fade" id="leaveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Leave League
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to leave <strong><%= league.league_name %></strong>?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warning:</strong> This action cannot be undone. You will need a new invitation to rejoin.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="POST" action="/leagues/<%= league.league_id %>/leave" class="d-inline">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-sign-out-alt me-2"></i>
                        Leave League
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
<% } %>

<!-- Delete League Modal -->
<% if (isCommissioner) { %>
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Delete League
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to permanently delete <strong><%= league.league_name %></strong>?</p>
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warning:</strong> This action cannot be undone. All league data, picks, and results will be permanently deleted.
                </div>
                <p><strong>Type the league name to confirm:</strong></p>
                <input type="text" class="form-control" id="confirmLeagueName" placeholder="<%= league.league_name %>">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>
                    <i class="fas fa-trash me-2"></i>
                    Delete League
                </button>
            </div>
        </div>
    </div>
</div>
<% } %>

<!-- Post Message Modal -->
<% if (isCommissioner) { %>
<div class="modal fade" id="postMessageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bullhorn me-2"></i>
                    Post Commissioner Message
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="messageTitle" class="form-label">Message Title</label>
                    <input type="text" class="form-control" id="messageTitle" placeholder="Enter message title..." maxlength="100" required>
                </div>
                <div class="mb-3">
                    <label for="messageContent" class="form-label">Message Content</label>
                    <textarea class="form-control" id="messageContent" rows="4" placeholder="Enter your message to all league members..." maxlength="1000" required></textarea>
                    <div class="form-text">This message will be visible to all league members on their dashboard.</div>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="messageImportant">
                        <label class="form-check-label" for="messageImportant">
                            Mark as important (will be highlighted)
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="postMessageBtn">
                    <i class="fas fa-paper-plane me-2"></i>Post Message
                </button>
            </div>
        </div>
    </div>
</div>
<% } %>

<link rel="stylesheet" href="/css/league-show.css">

<!-- League-specific data attributes -->
<div data-league-id="<%= league.league_id %>" style="display: none;"></div>

<script>
// League data for JavaScript
const leagueData = {
    league_id: '<%= league.league_id %>',
    league_name: '<%= league.league_name %>',
    commissioner_id: <%= league.commissioner_id %>,
    enable_multi_tier: <%= league.enable_multi_tier ? 'true' : 'false' %>,
    entry_fee: '<%= league.entry_fee %>',
    isCommissioner: <%= isCommissioner ? 'true' : 'false' %>
};



// Original league settings for complete restoration
originalLeagueData = {
    league_name: '<%= league.league_name %>',
    description: '<%= league.description || '' %>',
    privacy: '<%= league.privacy || 'private' %>',
    max_participants: <%= league.max_participants || 999 %>,
    max_entries: '<%= league.max_entries || 999 %>',
    entry_fee: '<%= league.entry_fee %>',
    enable_multi_tier: <%= league.enable_multi_tier ? 'true' : 'false' %>,
    unlimited_participants: <%= (!league.max_participants || league.max_participants >= 999) ? 'true' : 'false' %>,
    primary_tiebreaker: '<%= (league.settings && league.settings.primary_tiebreaker) || 'mnf_total' %>',
    secondary_tiebreaker: '<%= (league.settings && league.settings.secondary_tiebreaker) || 'highest_confidence_correct' %>'
};

// League name validation for delete
document.addEventListener('DOMContentLoaded', function() {
    const confirmInput = document.getElementById('confirmLeagueName');
    if (confirmInput) {
        confirmInput.setAttribute('data-league-name', '<%= league.league_name %>');
    }
});
</script>

<script src="/js/league-show.js"></script>
